# Tutorial 1: Create CI Workflow

<span style="color: #ff0000;">7-20-17 Finish converting text into hyperlinks</span>

This tutorial shows how to run a container-native, CI workflow on Kubernetes. You can see the Argo CI workflow for any Argo commit at [https://github.com/argoproj](https://github.com/argoproj)

<Picture of complex Argo CI workflow >

## Run Argo Sample CI Workflow

1.  Go to [](https://github.com/argoproj)[https://github.com/argoproj/ci-workflow/](https://github.com/argoproj/ci-workflow/) to access the sample <span class="UI_element">CI workflow</span> repository
2.  Review the file at [https://github.com/argoproj/ci-workflow/blob/master/.argo/example-workflow-approval.yaml](https://github.com/argoproj/ci-workflow/blob/master/.argo/example-workflow-approval.yaml) under `.argo` folder in that repo.

    The workflow has steps that checkouts the code, builds the code, runs multiple tests in parallel, sends an approval email and releases the code. Every step in the workflow needs to be defined as a container specification and creates a Kubernetes job. For details about writing the YAML DSL see the YAML tutorial at <span style="color: #ff0000;"><help url></span>

    *   So far, youâ€™ve looked at container templates for checking out code and building code, but how do you put everything together? That's where workflow templates come in! Workflows allow you to use other templates as steps in a larger process. Workflows may themselves be nested and used as steps in other workflows.

        The following workflow template checks out code and then builds it.

        The workflow template takes two input parameters named commit and repo.

    *   The workflow consists of two steps, called checkout and build.

    *   The checkout step simply invokes the applatix-checkout template that you previously defined. Since the template takes two optional parameters, the example just uses the default values.

    *   The build step invokes the example-build template with one parameter,code, which is bound to the code artifact generated by the preceding checkout step. In other words, the output artifact from the checkout step is used as an input artifact to the build step.

    *   The build step generates a container image that is pushed to a Docker registry. (The deployment step uses this image.)
    *   The `axapproval` template is a standard template that <span class="GeneralApplatix Platform Name">Argo</span> provides.
    *   The deploy step completes when the application finishes deploying. It does not wait for the application to finish running.
    *   Note that steps not separated by a dash ("-") are run in parallel.

    *   Rerunning the workflow redeploys the application. If an older version of the application is already running, it is upgraded to the new version.
3.  Because your Argo installation is automatically integrated with [https://github.com/argoproj](https://github.com/argoproj) repo, you can view it in your <span class="GeneralApplatix Cluster Console">Argo Web UI</span> in the <span class="UI_element">Catalog</span> along with other sample workflows and applications.
4.  Select <span class="UI_element">CI Workflow</span> from the Catalog and click <span class="UI_element">Run</span> to start the CI workflow.
5.  This workflow has a approval step that needs an email address as a mandatory input parameter called <span class="UI_element">REQUIRED_APPROVALS</span>. Enter an email address for an approver and click <span class="UI_element">Submit</span>.
6.  The workflow runs in <span class="GeneralApplatix Cluster Console">Argo Web UI</span> where every step is run as a container. You can check the log and artifact generated by clicking on each step.

## Create and Run Your Custom CI Workflow

### Create your YAML files

1.  Create an `.argo` folder under your repository
2.  Copy <span class="GeneralYAML template">YAML template</span>s from [https://github.com/argoproj/ci-workflow/](https://github.com/argoproj/ci-workflow/) to your `.argo` folder.
3.  The `axscm_checkout.yaml` file defines a container that <span class="GeneralApplatix Platform Name">Argo</span> provides for checking out code in your AWS S3 bucket which can be accessed by your other workflow steps.
4.  The `axapproval.yaml` file defines a container that <span class="GeneralApplatix Platform Name">Argo</span> provides for sending email for approval.
5.  The `example-policy.yaml` file defines when to trigger your CI workflow.
6.  Customize the `example-workflow-approval.yaml` file by writing your build, test and release containers
7.  The `example-approval-project.yaml` file defines how your project will show up in your <span class="UI_element">Catalog</span> menu. This is optional only if you want it to show up in your Catalog. Otherwise you can run it against your commits in the <span class="UI_element">Timelines</span> menu. You can also see and run all your <span class="GeneralYAML template">YAML template</span>s under the<span class="UI_element">Templates</span> menu.  
    <span style="color: #ff0000;">[Calvin] Why is example-build, example-test, example-release.yaml not explained here?</span>

### Manually RUN your CI workflow

1.  Because your Argo installation is integrated with your repo, you can see your commits in <span class="GeneralApplatix Cluster Console">Argo Web UI</span> under <span class="UI_element">Timeline</span> menu item
2.  You can select any commit and click "Create a New Job". Select the workflow name, enter values for the input parameters and click <span class="UI_element">Submit</span>
3.  The workflow runs in <span class="GeneralApplatix Cluster Console">Argo Web UI</span> where every step is run as a container. You can check the log and artifact generated by clicking on each step. For more details, see [Viewing Job History](../user_guide/timeline/create_job-viewhistory.htm#Viewing)

### Automatically TRIGGER your CI workflow

1.  As mentioned above, the `example-policy.yaml` file defines when to trigger your CI workflow.
2.  From the <span class="GeneralApplatix Cluster Console">Argo Web UI</span>, go to <span class="UI_element">Templates</span> menu and search for that policy and click <span class="UI_element">Enabled</span>.
3.  For every commit on that repo, based on the policy template, your CI workflow will get triggered.