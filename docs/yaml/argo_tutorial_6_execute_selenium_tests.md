# Tutorial 6: Running Nested Workflows

This tutorial shows how to use nested workflows to:

*   run a Selenium test against a web application ("Hello World") that runs in two web browsers (Chrome and Firefox)
*   record and output a video of screenshots taken during the test

In this tutorial, you'll run multiple steps, which are grouped into multiple, nested workflows as follows:

The **parent** workflow "**Selenium Demo**" runs these steps:
* Checks out code for Selenium app ("argo-checkout")
* Calls the workflow for the Selenium test and video conversion ("selenium-with-video-converter")

  The **first** nested workflow "selenium-with-video-converter" runs these steps:
 * Calls the workflow for the end-to-end test ("selenium-test-workflow")
 * Runs the container that performs the video conversion ("video-converter")

   The **second** nested workflow "selenium-test-workflow" runs this step:
   * Runs the end-to-end test

     NOTE: This step creates a container that runs the test, declares [fixtures](./../user_guide/infrastructure/using_fixtures.md) for the Selenium server, the web app to test, and video recorder, and issues the commands to run the test.

## Prerequisites

  This tutorial assumes the following:

  * You have successfully [installed Argo](https://argoproj.github.io/argo-site/get-started/installation).
  * You have integrated Argo with the sample odoo repo at [https://github.com/argoproj/ci-workflow](https://github.com/argoproj/ci-workflow)
  * You have [created an AWS RDS database instance of type "PostgreSQL"](http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_GettingStarted.CreatingConnecting.PostgreSQL.html). Make sure you've taken all default parameters and that Argo can access the database endpoint.

## About the YAML Files

The Selenium test workflow uses 3 YAML files from the ``.argo` directory of the repo at  [https://github.com/argoproj/appstore/](https://github.com/argoproj/appstore/):

* `argo-checkout.yaml`
* `selenium_all_ax.yaml` -  has a top-level workflow, which is supported by several nested workflows to execute the job :
    *   top level workflow: `selenium-example-workflow` (Calls the nested workflows, which checks out code from the repo, and runs the Selenium test with video recording)
    *   nested workflow: `axscm-checkout`(checks out the Selenium test code from the repo)
    *   nested workflow: `selenium-test-video-workflow` (This child workflow runs the actual test and converts the output of the test workflow video from .flv format to .mp4 format)
* `selenium_video_tools.yaml` - defines the containers for the video apps used to record and convert the video of the Selenium test.

    Every step in the workflow needs to be defined as a container specification and creates a Kubernetes job. For more details on the workflow and container YAML DSL please check the YAML tutorial at [Container Template](./../yaml/container_templates.md)

## Run Selenium test workflow

4.  Since your Argo installation is automatically integrated with [https://github.com/argoproj](https://github.com/argoproj) repo, you can view it in your Argo dashboard under Catalog menu item along with other samples
5.  Select **Selenium Testing** in the Catalog item and click Run to start the test with the nested workflows
6.  You will see the workflow running in Argo Web UI where every step is a container. You can check the log and artifact generated by clicking on each step.
7.  Once the workflow completes you will see a "Sampleapp" application deployed under Applications tab in Argo Web UI.

  ![Screenshot_Selenium_Test_Workflow](./../../images/Selenium_test_workflow_successful.png)

## Customize Your YAML Files

TBD

## Viewing the Test Outputs and Artifacts

You can view the video output of the Selenium test by going to the specific Job from the Timeline, clicking a container and selecting the icon for "**Download artifact video**":

To view a report, go to the E2E_TEST container and click "**Download artifact report**":

## Viewing Information for a Test Failure

When a test fails, you can view a report of the failure by clicking the container that has the red circle and selecting "**Browse artifact report**":

The dialog opens displaying the results and highlighting the lines that failed:

## Accessing the YAML Files for this Example

To see the YAML files for the Selenium test from the Argo Web UI, click **Catalog** > **DevOps** > **Selenium Testing.**

Or if you prefer to access the YAML templates from GitHub, go to [https://github.com/Argoproj/appstore](https://github.com/Argoproj/appstore) and click the .`argo` directory.
