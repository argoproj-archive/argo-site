---
type: workflow
version: 1
name: build-publish
inputs:
  parameters:
    commit:
      default: "%%session.commit%%"
    repo:
      default: "%%session.repo%%"
    tracking-id:
      default: "UA-105170809-1"
    href-base:
      default: "/argo-site/"
    base-url:
      default: "https://argoproj.github.io"
    git-user:
    git-password:
steps:
- build:
    template: build
    arguments:
      parameters.href-base: "%%inputs.parameters.href-base%%"
      parameters.tracking-id: "%%inputs.parameters.tracking-id%%"
- publish:
    image: argoproj/argoscm:v2.0
    command: ["sh", "-c"]
    env:
    - name: USER
      value: "%%inputs.parameters.git-user%%"
    - name: PASSWORD
      value: "%%inputs.parameters.git-password%%"
    args: ["git clone \"https://$USER:$PASSWORD@github.com/argoproj/argo-site.git\" -b gh-pages /src && cd /src && rm -rf ./assets && rm -rf ./docs && rm -rf ./index.html rm -rf ./webpack-assets.json && cp -r /argo-site/dist_rendered/* . && cp ./index.html ./404.html && rm ./docs/.gitignore && git add . && git commit -m \"Build on `date`\" && git push"]
    resources:
      mem_mib: 500
      cpu_cores: 0.1
    inputs:
      artifacts:
        code:
          from: "%%steps.build.outputs.artifacts.code%%"
          path: /argo-site
