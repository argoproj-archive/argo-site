---
type: workflow
version: 1
name: build-publish
inputs:
  parameters:
    commit:
        default: "%%session.commit%%"
    repo:
        default: "%%session.repo%%"
    git-user:
    git-password:
steps:
- build:
    template: build
- publish:
    image: argoproj/argoscm:v2.0
    command: ["sh", "-c"]
    env:
    - name: USER
      value: "%%inputs.parameters.git-user%%"
    - name: PASSWORD
      value: "%%inputs.parameters.git-password%%"
    args: ["git clone \"https://$USER:$PASSWORD@github.com:argoproj/argo-site.git\" -b gh-pages /src && cd /src && rm -rf ./assets && rm -rf ./docs && rm -rf ./index.html rm -rf ./webpack-assets.json && cp -r /argo-site/dist/* . && git add . && git commit -m \"Build on `date`\" && git push"]
    resources:
      mem_mib: 500
      cpu_cores: 0.1
    inputs:
      artifacts:
        code:
          from: "%%steps.build.outputs.artifacts.code%%"
          path: /argo-site
